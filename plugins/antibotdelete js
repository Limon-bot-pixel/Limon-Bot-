const fs = require("fs");

module.exports = {
    name: "antibotdelete",
    alias: ["abd", "botdelete", "antibotdel"],
    desc: "Auto delete messages from other bots",

    run: async (sock, msg, args) => {
        try {
            const from = msg.key.remoteJid;
            const cmd = args.trim().toLowerCase();

            global.antiBotDelete = global.antiBotDelete || {};

            if (!["on", "off"].includes(cmd)) {
                return sock.sendMessage(from, {
                    text: "üìå Example:\n.antibotdelete on\n.antibotdelete off\n\nüçã Limon Tip: On ‡¶ï‡¶∞‡¶≤‡ßá ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡¶ü‡ßá‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶¨‡¶ü ‡¶Ö‡¶ü‡ßã ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá!"
                });
            }

            global.antiBotDelete[from] = cmd === "on";

            return sock.sendMessage(from, {
                text: cmd === "on"
                    ? "üõ°üî• *Anti Bot Auto Delete ON!*\n‡¶è‡¶ñ‡¶® ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶¨‡¶ü ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶¶‡¶ø‡¶≤‡ßá Limon Bot ‡¶Ö‡¶ü‡ßã ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡ßá ‡¶¶‡ßá‡¶¨‡ßá‡•§"
                    : "üö´ Anti Bot Auto Delete OFF ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã‡•§"
            });

        } catch (err) {
            console.log("ANTIBOTDELETE CMD ERROR:", err);
        }
    }
};


// AUTO DELETE SYSTEM
module.exports.messageHandler = async (sock, msg) => {
    try {
        const jid = msg.key.remoteJid;

        if (!global.antiBotDelete[jid]) return;

        const sender = msg.key.participant || msg.key.remoteJid;

        // Bot identifier: @g.us ‡¶õ‡¶æ‡ßú‡¶æ ‡¶Ø‡¶æ‡¶¶‡ßá‡¶∞ 'bot' ‡¶Ü‡¶õ‡ßá, ‡¶¨‡¶æ ‡¶Ø‡¶æ‡¶¶‡ßá‡¶∞ forwarding score ‡¶¨‡ßá‡¶∂‡¶ø
        const isBot =
            sender.includes("bot") ||
            msg.message?.ephemeralMessage ||
            msg.message?.protocolMessage ||
            msg.message?.viewOnceMessage ||
            msg.message?.sendEphemeralNotification ||
            msg.message?.senderKeyDistributionMessage ||
            msg.message?.reactionMessage ||
            (msg.message?.conversation && msg.message.conversation.length > 150);

        if (isBot) {
            try {
                await sock.sendMessage(jid, {
                    delete: {
                        remoteJid: jid,
                        id: msg.key.id,
                        participant: sender
                    }
                });

                await sock.sendMessage(jid, {
                    text: `üõ°üî• *Limon AntiBot:* ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶¨‡¶ü‡ßá‡¶∞ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`
                });

            } catch (e) {
                console.log("DELETE FAILED:", e);
            }
        }

    } catch (err) {
        console.log("ANTIBOT DELETE SYSTEM ERROR:", err);
    }
};
